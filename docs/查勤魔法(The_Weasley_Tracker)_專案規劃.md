# 查勤魔法 The Weasley Tracker - MVP 專案規劃
※ 靈感來源於哈利波特 - 衛斯理鍾 (Weasley Clock)

## 專案概述

### 需求簡述
想法起源於工作日常所遇到的窘境，例如有時候難以掌握所有同仁的動態，在代替同仁接聽電話時，有時候會難以確認同仁狀態導致無法適當的回覆電話。
希望能透過應用程式獲取公司同仁的行動狀態，並結合 AI + MCP Tools 功能協助確認同仁當前狀態並回覆。

### MVP 專案目標
1. **概念驗證**：使用 Electron 開發桌面應用程式，驗證 AI + MCP Tools 的核心概念可行性
2. **單機模式**：使用 electron-store 儲存狀態，不需要線上同步，所有資料使用 Mock Data
3. **模擬多個使用者**：建立 Mock 使用者資料並實作簡易的登入/登出系統
4. **AI 調用 MCP tools**：實現 AI 理解使用者訊息，調用對應方法進行查詢、修改，並回覆使用者
5. **批量查詢功能**：支援自然語言詢問如「目前有誰在會議中？」、「小王、小李、小陳現在的狀態是？」

## 🎯 核心功能設計

### 1. 簡易登入系統
- 使用 Mock Data 模擬多個同仁的資料
- 簡單的登入/登出切換，模擬不同同仁操作應用程式

### 2. 基本狀態管理
- **6 種狀態**：
  - `on_duty`: 崗位上
  - `off_duty`: 已下班
  - `on_leave`: 請假
  - `wfh`: 遠端上班
  - `out`: 外出中
  - `meeting`: 會議中
- 在應用程式介面上，每位同仁只會顯示一種狀態

### 3. 簡化的狀態管理
- **基本狀態邏輯**：
  - 根據固定工作時間 (08:30-17:30) 自動判斷基本狀態
  - 當前時間 < 08:30：狀態為 `off_duty`
  - 08:30 ≤ 當前時間 ≤ 17:30：狀態為 `on_duty`
  - 當前時間 > 17:30：狀態為 `off_duty`
- **用戶自定義狀態**：
  - 用戶透過 AI 對話可設定任何狀態 (`on_duty`, `off_duty`, `wfh`, `on_leave`, `meeting`, `out`)
  - 設定的狀態會覆蓋基本狀態並保持持久性
  - 提供「重新整理」按鈕讓用戶恢復到基本狀態邏輯

### 4. AI 對話功能
- **查詢功能**：「小王現在在做什麼？」、「這位同仁今天遠端上班」
- **批量查詢**：「誰現在在會議中？」、「小王和小李現在在做什麼？」
- **狀態更新**：「我要外出，下午3點回來」，AI 會即時更新狀態為「外出中」

### 5. 狀態歷史記錄
- 記錄所有狀態變更歷史，包含變更時間和變更來源
- 不再有複雜的過期機制，狀態保持持久性直到下次變更

### 6. 自定義狀態標籤管理
- **功能說明**：允許使用者建立個人化狀態標籤，提供比基本6種狀態更細致的狀態描述
- **核心功能**：
  - **新增自定義標籤**：使用者可建立專屬的狀態標籤
  - **編輯現有標籤**：修改已建立的標籤名稱
  - **刪除標籤**：移除不需要的標籤
  - **選擇當前標籤**：從自定義標籤清單中選擇目前狀態
  - **清除標籤**：移除當前選擇的標籤
- **存取位置**：透過右上角使用者選單進行管理
- **資料儲存**：每位使用者個別管理自己的標籤清單
- **與核心狀態關係**：自定義標籤獨立於基本6種狀態類型，不影響狀態優先級解析，純粹作為使用者個人化標記功能

## 📊 資料結構設計

### 使用者資料表 (唯讀)
```typescript
interface MockUser {
  id: string
  name: string
  department: string
  tag?: string              // 目前選擇的自定義標籤
  customTags?: string[]     // 使用者自定義標籤清單
  workSchedule: {
    startTime: string // 固定為 "08:30"
    endTime: string // 固定為 "17:30"
  }
}
```


### 主狀態表 (可讀寫)
```typescript
type StatusType = 'on_duty' | 'off_duty' | 'on_leave' | 'wfh' | 'out' | 'meeting'

interface UserStatus {
  userId: string
  name: string

  // 當前狀態
  currentStatus: StatusType
  statusDetail?: string     // 狀態詳細描述
  lastUpdated: Date

  // 當日狀態變更歷史記錄
  statusHistory: StatusHistoryEntry[]
}

interface StatusHistoryEntry {
  id: string
  status: StatusType
  statusDetail?: string     // 狀態詳細描述
  timestamp: Date          // 變更時間
  source: 'system' | 'ai_modified' // 變更來源：系統自動或AI修改
}
```

## 🔄 業務邏輯設計

### 簡化的狀態管理邏輯

#### 基本狀態判斷
系統根據當前時間自動判斷基本狀態：
1. **當前時間 < 08:30**：狀態為 `off_duty`
2. **08:30 ≤ 當前時間 ≤ 17:30**：狀態為 `on_duty`
3. **當前時間 > 17:30**：狀態為 `off_duty`

#### 用戶自定義狀態
- 用戶可透過 AI 對話設定任何狀態 (`wfh`, `on_leave`, `meeting`, `out`)
- 設定的狀態會覆蓋基本狀態邏輯，並保持持久性
- 狀態保持不變直到用戶再次修改或點擊「重新整理」

#### 狀態重整機制
- 用戶點擊「重新整理」按鈕時，清除自定義狀態
- 系統回歸基本時間邊界檢查邏輯
- 記錄狀態變更到歷史記錄中

#### 狀態歷史記錄
- 記錄當日所有狀態變更，包含時間戳和變更來源
- 跨日時自動清空歷史記錄，重新開始記錄新的一日
- 變更來源分為：`system`（系統自動）和 `ai_modified`（AI 修改）
- 提供狀態變更的完整追蹤記錄

## 🛠 技術架構設計

### 簡化的資料策略
1. **應用程式啟動**
- 載入用戶基本資料和當前狀態
- **跨日檢查**：比較當前日期與頂層 `initializedDate`
  - 如果日期不符，重新初始化所有 mock data 並更新 `initializedDate`
  - 所有用戶共用同一個初始化日期，確保一致性的每日重置
- 根據當前時間執行基本狀態檢查

2. **狀態重新整理**
- 使用者點擊「重新整理」按鈕觸發
- 執行跨日檢查邏輯（若需要則完全重新生成資料）
- 清除用戶自定義狀態，回歸基本時間邊界邏輯
- 記錄狀態變更到歷史中

3. **AI 狀態更新**
- 使用者透過自然語言要求 AI 更新狀態時立即生效
- AI 調用 MCP tools 更新狀態並記錄到當日歷史中
- 新狀態直接覆蓋當前狀態，保持簡單明確的邏輯

### 跨日處理機制
- **單一日期管理**：頂層資料結構中的單一 `initializedDate` 
- **統一重置**：所有用戶在跨日邊界時一起重置
- **狀態歷史重置**：所有 `statusHistory` 陣列在新的一天清空
- **Mock Data 重新生成**：偵測到日期不匹配時完全重新生成
- **日期同步**：初始化日期的單一真相來源

### 狀態更新邏輯
#### 簡化的更新原則
1. **直接覆蓋**：新的狀態直接取代當前狀態
2. **歷史記錄**：所有變更都記錄到 statusHistory 中
3. **持久性**：狀態保持不變直到下次更新或重新整理

#### 狀態來源區分
- **system**：系統根據時間邊界自動設定的狀態
- **ai_modified**：使用者透過 AI 對話修改的狀態

**顯示邏輯**：應用程式顯示當前狀態，並提供歷史記錄查看功能。

### 使用技術
- **前端框架**：Electron (electron-vite v4.0.0) + Vue3 + TailwindCSS (v4)
- **前端路由**：Vue Router v4
- **資料儲存**：electron-store
- **開發語言**：TypeScript + Node.js
- **AI 整合**：@modelcontextprotocol/sdk
- **建構工具**：Vite
